{% extends "base.html" %}
{% import "macros/breadcrumbs.html" as breadcrumbs %}

{% block content %}
<div class="map-page" id="map-page">
    <!-- Breadcrumb Navigation -->
    {{ breadcrumbs::community(page=page, lang=detected_lang) }}

    <!-- Map Container -->
    <div class="map-container">
        <!-- Toolbar -->
        <div class="map-toolbar">
            <button class="map-toolbar__btn" id="map-fullscreen-btn" aria-label="Toggle fullscreen">
                <svg class="icon-expand" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <polyline points="9 21 3 21 3 15"></polyline>
                    <line x1="21" y1="3" x2="14" y2="10"></line>
                    <line x1="3" y1="21" x2="10" y2="14"></line>
                </svg>
                <svg class="icon-collapse" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="4 14 10 14 10 20"></polyline>
                    <polyline points="20 10 14 10 14 4"></polyline>
                    <line x1="14" y1="10" x2="21" y2="3"></line>
                    <line x1="3" y1="21" x2="10" y2="14"></line>
                </svg>
                <span>Fullscreen</span>
            </button>
            <button class="map-toolbar__btn" id="map-print-btn" aria-label="Print map">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                <span>Print</span>
            </button>
        </div>

        <div class="map-wrapper" id="map-wrapper">
            <div class="map-svg-container">
                <object
                    type="image/svg+xml"
                    data="{{ get_url(path='map/narrative-map.svg') }}"
                    class="map-svg"
                    id="map-svg"
                    aria-label="Wheel of Heaven Narrative Map - A visual guide through the cosmic narrative"
                >
                    <img
                        src="{{ get_url(path='map/narrative-map.svg') }}"
                        alt="Wheel of Heaven Narrative Map"
                        class="map-svg-fallback"
                    />
                </object>
            </div>
        </div>

        <!-- Info Section -->
        <section class="map-info">
            <div class="map-info__content">
                <h2 class="map-info__title">About This Map</h2>
                <p class="map-info__text">
                    This narrative map traces the transmission of cosmic knowledge through human history,
                    from the original contact with the Elohim to the present Age of Aquarius.
                    It illustrates how ancient wisdom has been preserved, distorted, and rediscovered
                    across millennia.
                </p>
                <div class="map-info__note">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    <span>Scroll vertically to explore the full timeline. Use pinch-to-zoom on touch devices.</span>
                </div>
            </div>
        </section>
    </div>
</div>

<script>
(function() {
    const mapPage = document.getElementById('map-page');
    const mapWrapper = document.getElementById('map-wrapper');
    const fullscreenBtn = document.getElementById('map-fullscreen-btn');
    const printBtn = document.getElementById('map-print-btn');

    // Fullscreen toggle
    fullscreenBtn.addEventListener('click', function() {
        if (!document.fullscreenElement) {
            mapWrapper.requestFullscreen().catch(err => {
                console.log('Fullscreen not supported:', err);
            });
        } else {
            document.exitFullscreen();
        }
    });

    // Update button state on fullscreen change
    document.addEventListener('fullscreenchange', function() {
        mapPage.classList.toggle('is-fullscreen', !!document.fullscreenElement);
    });

    // Print mode
    printBtn.addEventListener('click', function() {
        window.print();
    });
})();
</script>
{% endblock content %}
