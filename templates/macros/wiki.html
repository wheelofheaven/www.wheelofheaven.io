{# Wiki Macros - Reusable components for wiki pages #}

{# Macro for rendering a table of contents item #}
{% macro toc_item(item, level=1) %}
    <li class="wiki__toc-item wiki__toc-item--level-{{ level }}">
        <a href="#{{ item.id }}" class="wiki__toc-link">{{ item.title }}</a>
        {% if item.children %}
            <ul class="wiki__toc-sublist">
                {% for child in item.children %}
                    {{ self::toc_item(item=child, level=level + 1) }}
                {% endfor %}
            </ul>
        {% endif %}
    </li>
{% endmacro toc_item %}

{# Macro for rendering a reference entry #}
{% macro reference_entry(ref, index) %}
    <li class="wiki__reference-item" id="ref-{{ index }}">
        {% if ref.url %}
            <a href="{{ ref.url }}" class="wiki__reference-link" target="_blank" rel="noopener noreferrer">
                {{ ref.title }}
            </a>
        {% else %}
            <span class="wiki__reference-title">{{ ref.title }}</span>
        {% endif %}

        {% if ref.author %}
            <span class="wiki__reference-author">by {{ ref.author }}</span>
        {% endif %}

        {% if ref.publication %}
            <span class="wiki__reference-publication">{{ ref.publication }}</span>
        {% endif %}

        {% if ref.date %}
            <span class="wiki__reference-date">({{ ref.date }})</span>
        {% endif %}

        {% if ref.description %}
            <p class="wiki__reference-description">{{ ref.description }}</p>
        {% endif %}
    </li>
{% endmacro reference_entry %}

{# Macro for rendering a see also item #}
{% macro see_also_item(item, lang="en") %}
    <li class="wiki__link-item">
        {% if item.url %}
            <a href="{{ item.url }}" class="wiki__link">{{ item.title }}</a>
        {% else %}
            <a href="{{ get_url(path=item.path, lang=detected_lang) }}" class="wiki__link">{{ item.title }}</a>
        {% endif %}
        {% if item.description %}
            <span class="wiki__link-description">{{ item.description }}</span>
        {% endif %}
    </li>
{% endmacro see_also_item %}

{# Macro for rendering an external link item #}
{% macro external_link_item(link) %}
    <li class="wiki__link-item">
        <a href="{{ link.url }}" class="wiki__link wiki__link--external" target="_blank" rel="noopener noreferrer">
            {{ link.title }}
            <svg class="wiki__external-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15,3 21,3 21,9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
        </a>
        {% if link.description %}
            <span class="wiki__link-description">{{ link.description }}</span>
        {% endif %}
    </li>
{% endmacro external_link_item %}

{# Macro for rendering wiki card in section view #}
{% macro wiki_card(page) %}
    <article class="wiki-card">
        <div class="wiki-card__header">
            <h3 class="wiki-card__title">
                <a href="{{ page.permalink }}" class="wiki-card__link">{{ page.title }}</a>
            </h3>
            {% if page.extra.category %}
            <span class="wiki-card__category">{{ page.extra.category }}</span>
            {% endif %}
        </div>

        {% if page.extra.summary or page.description %}
        <div class="wiki-card__summary">
            {{ page.extra.summary | default(value=page.description) }}
        </div>
        {% endif %}

        <div class="wiki-card__meta">
            {% if page.date %}
            <time class="wiki-card__date">
                Updated {{ page.date | date(format="%b %d, %Y") }}
            </time>
            {% endif %}
            <span class="wiki-card__read-more">
                <a href="{{ page.permalink }}" class="wiki-card__read-link">
                    Read more
                    <svg class="wiki-card__arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14"></path>
                        <path d="M12 5l7 7-7 7"></path>
                    </svg>
                </a>
            </span>
        </div>
    </article>
{% endmacro wiki_card %}

{# Macro for rendering breadcrumbs #}
{% macro breadcrumbs(page, lang="en") %}
    <nav class="wiki__breadcrumbs" aria-label="Breadcrumb">
        <ol class="wiki__breadcrumb-list">
            <li class="wiki__breadcrumb-item">
                <a href="{{ get_url(path="/", lang=detected_lang) }}" class="wiki__breadcrumb-link">Home</a>
            </li>
            <li class="wiki__breadcrumb-item">
                <a href="{{ get_url(path="/wiki/", lang=detected_lang) }}" class="wiki__breadcrumb-link">Wiki</a>
            </li>
            {% if page.extra.category %}
            <li class="wiki__breadcrumb-item">
                <span class="wiki__breadcrumb-current">{{ page.extra.category }}</span>
            </li>
            {% endif %}
            <li class="wiki__breadcrumb-item">
                <span class="wiki__breadcrumb-current">{{ page.title }}</span>
            </li>
        </ol>
    </nav>
{% endmacro breadcrumbs %}

{# Macro for rendering a definition box #}
{% macro definition_box(term, definition) %}
    <div class="wiki__definition-box">
        <div class="wiki__definition-term">{{ term }}</div>
        <div class="wiki__definition-content">{{ definition | markdown | safe }}</div>
    </div>
{% endmacro definition_box %}

{# Macro for rendering an info box #}
{% macro info_box(title, content, type="info") %}
    <div class="wiki__info-box wiki__info-box--{{ type }}">
        {% if title %}
        <div class="wiki__info-box-title">{{ title }}</div>
        {% endif %}
        <div class="wiki__info-box-content">{{ content | markdown | safe }}</div>
    </div>
{% endmacro info_box %}
