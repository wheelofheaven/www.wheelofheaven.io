{# Snackbar Component Usage: {% include "partials/snackbar.html" %} This creates
a global snackbar container that can be used to show notifications. Call
showSnackbar(message, type, duration) from JavaScript to display notifications.
#}

<div
    id="snackbar-container"
    class="snackbar-container"
    aria-live="polite"
    aria-atomic="true"
>
    <!-- Snackbar notifications will be dynamically inserted here -->
</div>

<script>
    // Ensure snackbar functionality is available immediately
    (function () {
        // Global snackbar functionality
        window.snackbarTranslations = {
            copiedToClipboard:
                "{{ trans(key='snackbarCopiedToClipboard', lang=lang) }}",
            copyFailed: "{{ trans(key='snackbarCopyFailed', lang=lang) }}",
            success: "{{ trans(key='snackbarSuccess', lang=lang) }}",
            error: "{{ trans(key='snackbarError', lang=lang) }}",
            info: "{{ trans(key='snackbarInfo', lang=lang) }}",
            warning: "{{ trans(key='snackbarWarning', lang=lang) }}",
        };

        let snackbarCounter = 0;

        /**
         * Show a snackbar notification
         * @param {string} message - The message to display
         * @param {string} type - The type of notification (success, error, info, warning)
         * @param {number} duration - Duration in milliseconds (default: 4000)
         */
        window.showSnackbar = function (
            message,
            type = "info",
            duration = 4000,
        ) {
            const container = document.getElementById("snackbar-container");
            if (!container) {
                console.warn("Snackbar container not found");
                return;
            }

            // Create unique ID for this snackbar
            const snackbarId = `snackbar-${++snackbarCounter}`;

            // Create snackbar element
            const snackbar = document.createElement("div");
            snackbar.id = snackbarId;
            snackbar.className = `snackbar snackbar--${type}`;
            snackbar.setAttribute(
                "role",
                type === "error" ? "alert" : "status",
            );

            // Create icon based on type
            let icon = "";
            switch (type) {
                case "success":
                    icon =
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"></path></svg>';
                    break;
                case "error":
                    icon =
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
                    break;
                case "warning":
                    icon =
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
                    break;
                case "info":
                default:
                    icon =
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
                    break;
            }

            snackbar.innerHTML = `
                <div class="snackbar__content">
                    <div class="snackbar__icon">${icon}</div>
                    <div class="snackbar__message">${message}</div>
                    <button class="snackbar__close" onclick="window.hideSnackbar('${snackbarId}')" aria-label="Close notification">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="snackbar__progress"></div>
            `;

            // Add to container
            container.appendChild(snackbar);

            // Trigger entrance animation
            requestAnimationFrame(() => {
                snackbar.classList.add("snackbar--visible");
            });

            // Start progress bar animation
            const progressBar = snackbar.querySelector(".snackbar__progress");
            if (progressBar && duration > 0) {
                progressBar.style.animationDuration = `${duration}ms`;
                progressBar.classList.add("snackbar__progress--active");
            }

            // Auto-hide after duration
            if (duration > 0) {
                setTimeout(() => {
                    window.hideSnackbar(snackbarId);
                }, duration);
            }
        };

        /**
         * Hide a specific snackbar
         * @param {string} snackbarId - The ID of the snackbar to hide
         */
        window.hideSnackbar = function (snackbarId) {
            const snackbar = document.getElementById(snackbarId);
            if (!snackbar) return;

            snackbar.classList.add("snackbar--hiding");

            setTimeout(() => {
                if (snackbar && snackbar.parentNode) {
                    snackbar.parentNode.removeChild(snackbar);
                }
            }, 300);
        };

        /**
         * Show success notification for clipboard copy
         */
        window.showCopySuccess = function () {
            window.showSnackbar(
                window.snackbarTranslations.copiedToClipboard,
                "success",
                3000,
            );
        };

        /**
         * Show error notification for clipboard copy failure
         */
        window.showCopyError = function () {
            window.showSnackbar(
                window.snackbarTranslations.copyFailed,
                "error",
                4000,
            );
        };

        // Clear all snackbars when page unloads
        window.addEventListener("beforeunload", function () {
            const container = document.getElementById("snackbar-container");
            if (container) {
                container.innerHTML = "";
            }
        });
    })(); // End IIFE
</script>
