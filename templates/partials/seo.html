<!-- Open Graph / Facebook -->
<meta property="og:type" content="{% if page %}article{% else %}website{% endif %}">
<meta property="og:url" content="{{ current_url | safe }}">
<meta property="og:title" content="{% if page.title %}{{ page.title }}{% elif section.title %}{{ section.title }}{% else %}{{ config.title }}{% endif %}">
<meta property="og:description" content="{% if page.extra.tldr %}{{ page.extra.tldr }}{% elif page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
<meta property="og:image" content="{% if page.extra.image %}{{ get_url(path=page.extra.image) }}{% elif page.extra.header_image %}{{ get_url(path=page.extra.header_image) }}{% elif section.extra.image %}{{ get_url(path=section.extra.image) }}{% else %}{{ get_url(path="brand/og-image.png") }}{% endif %}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="{{ config.title }}">
<meta property="og:locale" content="{{ detected_lang | default(value='en') | replace(from="-", to="_") }}">
{% if page and page.date %}
<meta property="article:published_time" content="{{ page.date | date(format="%Y-%m-%dT%H:%M:%S") }}+00:00">
{% endif %}
{% if page and page.updated %}
<meta property="article:modified_time" content="{{ page.updated | date(format="%Y-%m-%dT%H:%M:%S") }}+00:00">
{% endif %}
{% if page.extra.category %}
<meta property="article:section" content="{{ page.extra.category }}">
{% endif %}
{% if page.taxonomies.authors %}
    {% for author in page.taxonomies.authors %}
<meta property="article:author" content="{{ author }}">
    {% endfor %}
{% endif %}
{% if page.taxonomies.tags %}
    {% for tag in page.taxonomies.tags %}
<meta property="article:tag" content="{{ tag }}">
    {% endfor %}
{% endif %}

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ current_url | safe }}">
<meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% elif section.title %}{{ section.title }}{% else %}{{ config.title }}{% endif %}">
<meta name="twitter:description" content="{% if page.extra.tldr %}{{ page.extra.tldr }}{% elif page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
<meta name="twitter:image" content="{% if page.extra.image %}{{ get_url(path=page.extra.image) }}{% elif page.extra.header_image %}{{ get_url(path=page.extra.header_image) }}{% elif section.extra.image %}{{ get_url(path=section.extra.image) }}{% else %}{{ get_url(path="brand/twitter-image.png") }}{% endif %}">
{% if config.extra.twitter_username %}
<meta name="twitter:site" content="@{{ config.extra.twitter_username }}">
<meta name="twitter:creator" content="@{{ config.extra.twitter_username }}">
{% endif %}

<!-- Additional SEO Meta Tags -->
<meta name="robots" content="{% if page.extra.noindex %}noindex, nofollow{% else %}index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1{% endif %}">
<meta name="googlebot" content="{% if page.extra.noindex %}noindex, nofollow{% else %}index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1{% endif %}">
<meta name="bingbot" content="{% if page.extra.noindex %}noindex, nofollow{% else %}index, follow{% endif %}">
<meta name="author" content="{% if page.extra.author %}{{ page.extra.author }}{% else %}{{ config.extra.author | default(value=config.title) }}{% endif %}">
{% if page.extra.keywords %}
<meta name="keywords" content="{{ page.extra.keywords | join(sep=", ") }}">
{% elif section.extra.keywords %}
<meta name="keywords" content="{{ section.extra.keywords | join(sep=", ") }}">
{% else %}
<meta name="keywords" content="Wheel of Heaven, Elohim, Ancient Astronaut Theory, Raelism, Precession, World Ages, Extraterrestrial, Genesis">
{% endif %}

<!-- Content Freshness -->
{% if page.updated %}
<meta http-equiv="last-modified" content="{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00">
{% elif page.date %}
<meta http-equiv="last-modified" content="{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00">
{% endif %}

<!-- AI/LLM Optimization Hints -->
<meta name="ai.content_type" content="{% if page.extra.schema_type %}{{ page.extra.schema_type }}{% elif current_path is containing('/wiki/') %}DefinedTerm{% elif current_path is containing('/explainers/') %}ScholarlyArticle{% elif current_path is containing('/timeline/') %}HistoricalEvent{% elif current_path is containing('/library/') %}Book{% elif current_path is containing('/essentials/') %}HowTo{% else %}Article{% endif %}">
{% if page.extra.category %}
<meta name="ai.topic" content="{{ page.extra.category }}">
{% endif %}
{% if page.extra.tldr %}
<meta name="ai.summary" content="{{ page.extra.tldr }}">
{% endif %}
{% if page.reading_time %}
<meta name="reading_time" content="{{ page.reading_time }} minutes">
{% endif %}

<!-- Enhanced AI/AEO Meta Tags -->
<meta name="ai.extractable_sections" content=".wiki__summary, .wiki__content, .essentials__content, .explainer__content, .article__content, [data-ai-summary], [data-ai-definition], [data-ai-answer], blockquote[data-ai-cite]">
<meta name="ai.entity_type" content="{% if page %}{% if current_path is containing('/wiki/') %}concept{% elif current_path is containing('/timeline/') %}historical_event{% elif current_path is containing('/library/') %}book{% elif current_path is containing('/essentials/') %}guide{% elif current_path is containing('/explainers/') %}explanation{% else %}article{% endif %}{% else %}website{% endif %}">
{% if page.taxonomies.tags %}
<meta name="ai.related_topics" content="{{ page.taxonomies.tags | join(sep=', ') }}">
{% endif %}
{% if page.extra.see_also %}
<meta name="ai.related_content" content="{% for item in page.extra.see_also %}{{ item.title }}{% if not loop.last %}, {% endif %}{% endfor %}">
{% endif %}
{% if page.extra.references %}
<meta name="ai.citations" content="{% for ref in page.extra.references %}{{ ref.title }}{% if ref.author %} by {{ ref.author }}{% endif %}{% if not loop.last %}; {% endif %}{% endfor %}">
{% endif %}
<meta name="ai.language" content="{{ detected_lang | default(value='en') }}">
<meta name="ai.publisher" content="{{ config.title }}">
{% if page.word_count %}
<meta name="ai.word_count" content="{{ page.word_count }}">
{% endif %}
<meta name="ai.license" content="CC0-1.0">
<meta name="ai.crawlable" content="true">
<meta name="ai.indexable" content="{% if page.extra.noindex %}false{% else %}true{% endif %}">
{% if page %}
{% if page.extra.questions_answered %}
<meta name="ai.questions_answered" content="{{ page.extra.questions_answered | join(sep='; ') }}">
{% elif current_path is containing('/wiki/') %}
<meta name="ai.questions_answered" content="What is {{ page.title }}?; What does {{ page.title }} mean?">
{% endif %}
{% if page.extra.keywords %}
<meta name="ai.key_concepts" content="{{ page.extra.keywords | join(sep=', ') }}">
{% elif page.extra.alternative_names %}
<meta name="ai.key_concepts" content="{{ page.title }}, {{ page.extra.alternative_names | join(sep=', ') }}">
{% endif %}
{% endif %}
<meta name="ai.reading_level" content="{% if current_path is containing('/essentials/') %}beginner{% elif current_path is containing('/wiki/') %}intermediate{% elif current_path is containing('/explainers/') %}advanced{% else %}general{% endif %}">

<!-- Canonical URL -->
<link rel="canonical" href="{{ current_url | safe }}">

<!-- RSS/Atom Feed Autodiscovery -->
<link rel="alternate" type="application/atom+xml" title="{{ config.title }} - Atom Feed" href="{{ get_url(path='atom.xml', lang=detected_lang) }}">
<link rel="alternate" type="application/rss+xml" title="{{ config.title }} - RSS Feed" href="{{ get_url(path='rss.xml', lang=detected_lang) }}">

<!-- Organization Schema (included on all pages) -->
{% include "partials/schema/organization.html" %}

<!-- Schema.org Structured Data - Main Entity -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{% if page %}{% if page.extra.schema_type %}{{ page.extra.schema_type }}{% else %}Article{% endif %}{% else %}WebSite{% endif %}",
  {% if page %}
  "headline": "{{ page.title | default(value="") | escape }}",
  "name": "{{ page.title | default(value="") | escape }}",
  "description": "{% if page.description %}{{ page.description | escape }}{% else %}{{ config.description | default(value="") | escape }}{% endif %}",
  {% if page.extra.tldr %}
  "abstract": "{{ page.extra.tldr | escape }}",
  {% endif %}
  "url": "{{ current_url | safe }}",
  {% if page.date %}
  "datePublished": "{{ page.date | date(format="%Y-%m-%dT%H:%M:%S") }}+00:00",
  {% endif %}
  {% if page.updated %}
  "dateModified": "{{ page.updated | date(format="%Y-%m-%dT%H:%M:%S") }}+00:00",
  {% elif page.date %}
  "dateModified": "{{ page.date | date(format="%Y-%m-%dT%H:%M:%S") }}+00:00",
  {% endif %}
  {% if page.extra.image or page.extra.header_image %}
  "image": {
    "@type": "ImageObject",
    "url": "{{ get_url(path=page.extra.image | default(value=page.extra.header_image)) }}",
    "name": "{{ page.title | default(value='') | escape }} - Featured Image",
    "description": "{% if page.extra.image_alt %}{{ page.extra.image_alt | escape }}{% elif page.description %}{{ page.description | truncate(length=150) | escape }}{% else %}Featured image for {{ page.title | default(value='') | escape }}{% endif %}",
    "width": 1200,
    "height": 630,
    "caption": "{% if page.extra.image_caption %}{{ page.extra.image_caption | escape }}{% else %}{{ page.title | default(value='') | escape }}{% endif %}"
  },
  {% endif %}
  {% if page.extra.category %}
  "articleSection": "{{ page.extra.category }}",
  {% endif %}
  {% if page.reading_time %}
  "timeRequired": "PT{{ page.reading_time }}M",
  {% endif %}
  {% if page.word_count %}
  "wordCount": {{ page.word_count }},
  {% endif %}
  "inLanguage": "{{ detected_lang | default(value='en') }}",
  "isAccessibleForFree": true,
  "author": {
    "@type": "{{ config.extra.author_type | default(value='Organization') }}",
    "name": "{% if page.extra.author %}{{ page.extra.author | escape }}{% else %}{{ config.extra.author | default(value=config.title) | default(value="") | escape }}{% endif %}",
    "@id": "{{ config.extra.organization_id | default(value=config.base_url ~ '/#organization') }}"
  },
  "publisher": {
    "@type": "Organization",
    "@id": "{{ config.extra.organization_id | default(value=config.base_url ~ '/#organization') }}",
    "name": "{{ config.title | default(value="") | escape }}",
    "url": "{{ config.base_url }}",
    {% if config.extra.logo %}
    "logo": {
      "@type": "ImageObject",
      "url": "{{ get_url(path=config.extra.logo) }}"
    }
    {% endif %}
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ current_url | safe }}"
  },
  "isPartOf": {
    "@type": "WebSite",
    "@id": "{{ config.base_url }}/#website",
    "name": "{{ config.title }}",
    "url": "{{ config.base_url }}"
  }
  {% else %}
  "@id": "{{ config.base_url }}/#website",
  "name": "{{ config.title | default(value="") | escape }}",
  "description": "{{ config.description | default(value="") | escape }}",
  "url": "{{ config.base_url }}",
  "inLanguage": "{{ detected_lang | default(value='en') }}",
  {% if config.extra.logo %}
  "logo": "{{ get_url(path=config.extra.logo) }}",
  {% endif %}
  "sameAs": [
    {% if config.extra.social_links %}
      {% for link in config.extra.social_links %}
    "{{ link }}"{% if not loop.last %},{% endif %}
      {% endfor %}
    {% endif %}
  ],
  "publisher": {
    "@type": "Organization",
    "@id": "{{ config.extra.organization_id | default(value=config.base_url ~ '/#organization') }}"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ config.base_url }}/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
  {% endif %}
}
</script>

<!-- Speakable Specification for Voice Assistants -->
{% include "partials/schema/speakable.html" %}

<!-- Additional Schema.org for Breadcrumbs (if applicable) -->
{% if section or page.ancestors %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "@id": "{{ current_url | safe }}#breadcrumb",
  "name": "Breadcrumb Navigation",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {
        "@type": "WebPage",
        "@id": "{{ config.base_url }}/",
        "url": "{{ config.base_url }}/",
        "name": "Home"
      }
    }
    {% if page %}
      {% for ancestor in page.ancestors %}
        {% set ancestor_section = get_section(path=ancestor) %}
        ,{
          "@type": "ListItem",
          "position": {{ loop.index + 1 }},
          "name": "{{ ancestor_section.title | default(value='') | escape }}",
          "item": {
            "@type": "WebPage",
            "@id": "{{ ancestor_section.permalink }}",
            "url": "{{ ancestor_section.permalink }}",
            "name": "{{ ancestor_section.title | default(value='') | escape }}"
          }
        }
      {% endfor %}
      ,{
        "@type": "ListItem",
        "position": {{ page.ancestors | length + 2 }},
        "name": "{{ page.title | default(value='') | escape }}",
        "item": {
          "@type": "WebPage",
          "@id": "{{ page.permalink }}",
          "url": "{{ page.permalink }}",
          "name": "{{ page.title | default(value='') | escape }}"
        }
      }
    {% elif section %}
      {% for ancestor in section.ancestors %}
        {% set ancestor_section = get_section(path=ancestor) %}
        ,{
          "@type": "ListItem",
          "position": {{ loop.index + 1 }},
          "name": "{{ ancestor_section.title | default(value='') | escape }}",
          "item": {
            "@type": "WebPage",
            "@id": "{{ ancestor_section.permalink }}",
            "url": "{{ ancestor_section.permalink }}",
            "name": "{{ ancestor_section.title | default(value='') | escape }}"
          }
        }
      {% endfor %}
      ,{
        "@type": "ListItem",
        "position": {{ section.ancestors | length + 2 }},
        "name": "{{ section.title | default(value='') | escape }}",
        "item": {
          "@type": "WebPage",
          "@id": "{{ section.permalink }}",
          "url": "{{ section.permalink }}",
          "name": "{{ section.title | default(value='') | escape }}"
        }
      }
    {% endif %}
  ]
}
</script>
{% endif %}

<!-- DNS Prefetch for External Resources -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
{% if config.extra.analytics_domain %}
<link rel="dns-prefetch" href="//{{ config.extra.analytics_domain }}">
{% endif %}

<!-- Preload Critical Resources -->
{% if page.extra.image %}
<link rel="preload" as="image" href="{{ get_url(path=page.extra.image) }}">
{% elif page.extra.header_image %}
<link rel="preload" as="image" href="{{ get_url(path=page.extra.header_image) }}">
{% elif section.extra.image %}
<link rel="preload" as="image" href="{{ get_url(path=section.extra.image) }}">
{% endif %}
