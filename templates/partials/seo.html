<!-- Open Graph / Facebook -->
<meta property="og:type" content="{% if page %}article{% else %}website{% endif %}">
<meta property="og:url" content="{{ current_url | safe }}">
<meta property="og:title" content="{% if page.title %}{{ page.title }}{% elif section.title %}{{ section.title }}{% else %}{{ config.title }}{% endif %}">
<meta property="og:description" content="{% if page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
<meta property="og:image" content="{% if page.extra.image %}{{ get_url(path=page.extra.image) }}{% elif section.extra.image %}{{ get_url(path=section.extra.image) }}{% else %}{{ get_url(path="brand/og-image.png") }}{% endif %}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="{{ config.title }}">
<meta property="og:locale" content="{{ lang | replace(from="-", to="_") }}">
{% if page and page.date %}
<meta property="article:published_time" content="{{ page.date | date(format="%Y-%m-%d") }}">
{% endif %}
{% if page and page.updated %}
<meta property="article:modified_time" content="{{ page.updated | date(format="%Y-%m-%d") }}">
{% endif %}
{% if page.taxonomies.authors %}
    {% for author in page.taxonomies.authors %}
<meta property="article:author" content="{{ author }}">
    {% endfor %}
{% endif %}
{% if page.taxonomies.tags %}
    {% for tag in page.taxonomies.tags %}
<meta property="article:tag" content="{{ tag }}">
    {% endfor %}
{% endif %}

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ current_url | safe }}">
<meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% elif section.title %}{{ section.title }}{% else %}{{ config.title }}{% endif %}">
<meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
<meta name="twitter:image" content="{% if page.extra.image %}{{ get_url(path=page.extra.image) }}{% elif section.extra.image %}{{ get_url(path=section.extra.image) }}{% else %}{{ get_url(path="brand/twitter-image.png") }}{% endif %}">
{% if config.extra.twitter_username %}
<meta name="twitter:site" content="@{{ config.extra.twitter_username }}">
<meta name="twitter:creator" content="@{{ config.extra.twitter_username }}">
{% endif %}

<!-- Additional SEO Meta Tags -->
<meta name="robots" content="{% if page.extra.noindex %}noindex, nofollow{% else %}index, follow{% endif %}">
<meta name="googlebot" content="{% if page.extra.noindex %}noindex, nofollow{% else %}index, follow{% endif %}">
<meta name="author" content="{% if page.extra.author %}{{ page.extra.author }}{% else %}{{ config.extra.author | default(value=config.title) }}{% endif %}">
{% if page.extra.keywords %}
<meta name="keywords" content="{{ page.extra.keywords | join(sep=", ") }}">
{% elif section.extra.keywords %}
<meta name="keywords" content="{{ section.extra.keywords | join(sep=", ") }}">
{% endif %}

<!-- Canonical URL -->
<link rel="canonical" href="{{ current_url | safe }}">

<!-- Schema.org Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{% if page %}{% if page.extra.schema_type %}{{ page.extra.schema_type }}{% else %}Article{% endif %}{% else %}WebSite{% endif %}",
  {% if page %}
  "headline": "{{ page.title | default(value="") | escape }}",
  "description": "{% if page.description %}{{ page.description | escape }}{% else %}{{ config.description | default(value="") | escape }}{% endif %}",
  "url": "{{ current_url | safe }}",
  {% if page.date %}
  "datePublished": "{{ page.date | date(format="%Y-%m-%d") }}",
  {% endif %}
  {% if page.updated %}
  "dateModified": "{{ page.updated | date(format="%Y-%m-%d") }}",
  {% endif %}
  {% if page.extra.image %}
  "image": {
    "@type": "ImageObject",
    "url": "{{ get_url(path=page.extra.image) }}",
    "width": 1200,
    "height": 630
  },
  {% endif %}
  "author": {
    "@type": "{% if config.extra.author_type %}{{ config.extra.author_type }}{% else %}Person{% endif %}",
    "name": "{% if page.extra.author %}{{ page.extra.author | escape }}{% else %}{{ config.extra.author | default(value=config.title) | default(value="") | escape }}{% endif %}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ config.title | default(value="") | escape }}",
    "url": "{{ config.base_url }}",
    {% if config.extra.logo %}
    "logo": {
      "@type": "ImageObject",
      "url": "{{ get_url(path=config.extra.logo) }}"
    }
    {% endif %}
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ current_url | safe }}"
  }
  {% else %}
  "name": "{{ config.title | default(value="") | escape }}",
  "description": "{{ config.description | default(value="") | escape }}",
  "url": "{{ config.base_url }}",
  {% if config.extra.logo %}
  "logo": "{{ get_url(path=config.extra.logo) }}",
  {% endif %}
  "sameAs": [
    {% if config.extra.social_links %}
      {% for link in config.extra.social_links %}
    "{{ link }}"{% if not loop.last %},{% endif %}
      {% endfor %}
    {% endif %}
  ],
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ config.base_url }}/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
  {% endif %}
}
</script>

<!-- Additional Schema.org for Breadcrumbs (if applicable) -->
{% if section or page.ancestors %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ config.base_url }}"
    }
    {% if page %}
      {% for ancestor in page.ancestors %}
        {% set ancestor_section = get_section(path=ancestor) %}
        ,{
          "@type": "ListItem",
          "position": {{ loop.index + 1 }},
          "name": "{{ ancestor_section.title | default(value="") | escape }}",
          "item": "{{ ancestor_section.permalink }}"
        }
      {% endfor %}
      ,{
        "@type": "ListItem",
        "position": {{ page.ancestors | length + 2 }},
        "name": "{{ page.title | default(value="") | escape }}",
        "item": "{{ page.permalink }}"
      }
    {% elif section %}
      {% for ancestor in section.ancestors %}
        {% set ancestor_section = get_section(path=ancestor) %}
        ,{
          "@type": "ListItem",
          "position": {{ loop.index + 1 }},
          "name": "{{ ancestor_section.title | default(value="") | escape }}",
          "item": "{{ ancestor_section.permalink }}"
        }
      {% endfor %}
      ,{
        "@type": "ListItem",
        "position": {{ section.ancestors | length + 2 }},
        "name": "{{ section.title | default(value="") | escape }}",
        "item": "{{ section.permalink }}"
      }
    {% endif %}
  ]
}
</script>
{% endif %}

<!-- DNS Prefetch for External Resources -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
{% if config.extra.analytics_domain %}
<link rel="dns-prefetch" href="//{{ config.extra.analytics_domain }}">
{% endif %}

<!-- Preload Critical Resources -->
{% if page.extra.image %}
<link rel="preload" as="image" href="{{ get_url(path=page.extra.image) }}">
{% elif section.extra.image %}
<link rel="preload" as="image" href="{{ get_url(path=section.extra.image) }}">
{% endif %}
