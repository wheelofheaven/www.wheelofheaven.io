{% extends "base.html" %} {% block content %} {% set ages_data =
load_data(path="data/ages.json") %}
<div class="timeline-section" role="region" aria-label="Timeline of World Ages">
    <!-- Sun behind Earth -->
    <div class="earth-sunrise">
        <img src="/images/sunrise.png" alt="Sun" class="sunrise-image" />
    </div>

    <!-- Fixed Earth (SVG) -->
    <div class="earth-container">
        <svg width="600" height="600">
            <defs>
                <pattern
                    id="earthTexture"
                    patternUnits="objectBoundingBox"
                    width="1"
                    height="1"
                >
                    <image
                        href="/images/earth/earth-ocean-mist.png"
                        width="600"
                        height="600"
                    />
                </pattern>
            </defs>
            <circle cx="300" cy="300" r="300" fill="url(#earthTexture)" />
        </svg>
    </div>

    <!-- Scrolling Starmap Background - 3 repeating starmaps -->
    <div class="starmap-background">
        <div class="starmap-container" id="starmap-container">
            <!-- Left starmap (previous cycle) -->
            <img
                src="/starmap.svg"
                alt="Star Map Left"
                class="starmap-layer starmap-layer--left"
            />
            <!-- Center starmap (current cycle) -->
            <img
                src="/starmap.svg"
                alt="Star Map Center"
                class="starmap-layer starmap-layer--center"
            />
            <!-- Right starmap (next cycle) -->
            <img
                src="/starmap.svg"
                alt="Star Map Right"
                class="starmap-layer starmap-layer--right"
            />
        </div>
    </div>

    <!-- Integrated Age Card Container -->
    <div class="age-card-container" role="region" aria-label="Current age display">
        <!-- Navigation buttons positioned on sides of container -->
        <button
            class="timeline-nav__btn timeline-nav__btn--prev"
            id="nav-prev"
            aria-label="Navigate to previous age"
        >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                    d="M15 18L9 12L15 6"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                />
            </svg>
        </button>

        <button
            class="timeline-nav__btn timeline-nav__btn--next"
            id="nav-next"
            aria-label="Navigate to next age"
        >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                    d="M9 6L15 12L9 18"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                />
            </svg>
        </button>

        <div class="age-card" id="age-card" aria-live="polite" aria-atomic="true">
            <div class="age-card__symbol" id="age-symbol" aria-hidden="true">♑</div>

            <div class="age-card__content">
                <h2 class="age-card__title" id="age-title">Age of Capricorn</h2>
                <div class="age-card__timespan" id="age-timespan" aria-label="Time period">
                    21810 BC → 19650 BC
                </div>
                <div class="age-card__description" id="age-description" data-ai-summary="true">
                    Synthetic life engineering on the Elohim home planet with
                    the inevitable escape of synthetic 'monster' lifeforms.
                    Earth discovered, exploration. Known as the 1st day of
                    Creation (Genesis)
                </div>

                <!-- Images section -->
                <div class="age-card__images" id="age-card-images">
                    <!-- Up to 3 landscape images will be inserted here dynamically -->
                </div>

                <div class="age-card__footer">
                    <a
                        href="/timeline/age-of-capricorn"
                        class="age-card__link"
                        id="age-link"
                    >
                        Explore This Age
                        <svg
                            class="age-card__link-icon"
                            width="16"
                            height="16"
                            viewBox="0 0 16 16"
                            fill="none"
                        >
                            <path
                                d="M6 12L10 8L6 4"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            />
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Age Progress with 12 segments - positioned at bottom of card -->
            <div class="age-progress" role="navigation" aria-label="Age selection">
                <div class="age-progress__segments" id="age-progress-segments" role="group" aria-label="Age indicators">
                    <div class="age-progress__segment" data-segment="0">✦</div>
                    <div class="age-progress__segment" data-segment="1">♑</div>
                    <div class="age-progress__segment" data-segment="2">♐</div>
                    <div class="age-progress__segment" data-segment="3">♏</div>
                    <div class="age-progress__segment" data-segment="4">♎</div>
                    <div class="age-progress__segment" data-segment="5">♍</div>
                    <div class="age-progress__segment" data-segment="6">♌</div>
                    <div class="age-progress__segment" data-segment="7">♋</div>
                    <div class="age-progress__segment" data-segment="8">♊</div>
                    <div class="age-progress__segment" data-segment="9">♉</div>
                    <div class="age-progress__segment" data-segment="10">
                        ♈
                    </div>
                    <div class="age-progress__segment" data-segment="11">
                        ♓
                    </div>
                    <div class="age-progress__segment" data-segment="12">
                        ♒
                    </div>
                </div>

                <!-- Age Selector Dropdown -->
                <div class="age-selector__dropdown" id="age-selector-dropdown">
                    <!-- In the beginning entry -->
                    <button
                        class="age-selector__option"
                        data-age-index="0"
                        data-age-color="yellow"
                    >
                        <span class="age-selector__option-symbol">✦</span>
                        <span>In the beginning...</span>
                    </button>
                    {% for age in ages_data %}
                    <button
                        class="age-selector__option"
                        data-age-index="{{ loop.index }}"
                        data-age-color="{{ age.color }}"
                    >
                        <span class="age-selector__option-symbol"
                            >{{ age.symbol }}</span
                        >
                        <span>{{ age.name }}</span>
                    </button>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Horizontal Timeline Content -->
<div class="timeline-content" id="timeline-content">
    <!-- In the beginning section -->
    <div class="timeline-age-section" data-age-index="0">
        <!-- Each age section is 100vw wide -->
    </div>
    {% for age in ages_data %}
    <div class="timeline-age-section" data-age-index="{{ loop.index }}">
        <!-- Each age section is 100vw wide -->
    </div>
    {% endfor %}
</div>

<script src="/js/timeline.js"></script>
<script>
// Space overlay detection for light theme readability
(function() {
    const worldAgesSection = document.querySelector('.world-ages-section');
    if (!worldAgesSection) return;

    function updateSpaceOverlay() {
        const isLightTheme = document.documentElement.getAttribute('data-theme') === 'light';
        const rect = worldAgesSection.getBoundingClientRect();
        // User is in space section if world-ages-section hasn't reached the top of viewport yet
        const inSpaceSection = rect.top > 100;

        if (isLightTheme && inSpaceSection) {
            document.body.classList.add('timeline-space-overlay');
        } else {
            document.body.classList.remove('timeline-space-overlay');
        }
    }

    // Run on scroll
    window.addEventListener('scroll', updateSpaceOverlay, { passive: true });

    // Run on theme change
    const observer = new MutationObserver(updateSpaceOverlay);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

    // Initial check
    updateSpaceOverlay();
})();
</script>

<!-- World Ages Cards Section -->
<section class="world-ages-section" aria-labelledby="world-ages-heading">
    <div class="world-ages-section__container">
        <header class="world-ages-section__header">
            <h2 class="world-ages-section__title" id="world-ages-heading">Explore the World Ages</h2>
            <p class="world-ages-section__description">
                Dive deeper into each cosmic age and discover the events that
                shaped our world's history.
            </p>
        </header>

        <div class="world-ages-section__grid" role="list" aria-label="World ages">
            <!-- In the beginning card -->
            <article class="world-age-card" data-age-color="yellow" role="listitem">
                <a
                    href="/timeline/in-the-beginning"
                    class="world-age-card__link"
                >
                    <div class="world-age-card__content">
                        <div class="world-age-card__header">
                            <div class="world-age-card__symbol">✦</div>
                            <h3 class="world-age-card__title">
                                In the beginning...
                            </h3>
                        </div>

                        <div class="world-age-card__timespan">
                            23970 BC
                            <span class="world-age-card__separator"> → </span>
                            21810 BC
                        </div>

                        <p class="world-age-card__description">
                            Before time began, in the vast expanse of the
                            cosmos, the Elohim civilization flourished. Advanced
                            beings who mastered science and creation, they would
                            soon discover our world and begin the greatest
                            experiment in galactic history.
                        </p>

                        <div class="world-age-card__footer">
                            <span class="world-age-card__read-more">
                                Explore Age
                                <svg
                                    class="world-age-card__arrow"
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <polyline
                                        points="9,18 15,12 9,6"
                                    ></polyline>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <!-- Images displayed side by side -->
                    <div
                        class="world-age-card__images"
                        id="world-age-images-beginning"
                    >
                        <!-- Images will be populated by JavaScript -->
                    </div>
                </a>
            </article>

            {% for age in ages_data %}
            <article class="world-age-card" data-age-color="{{ age.color }}" role="listitem">
                <a href="{{ age.link }}" class="world-age-card__link">
                    <div class="world-age-card__content">
                        <div class="world-age-card__header">
                            <div class="world-age-card__symbol">
                                {{ age.symbol }}
                            </div>
                            <h3 class="world-age-card__title">
                                {{ age.name }}
                            </h3>
                        </div>

                        <div class="world-age-card__timespan">
                            {% set start_year = age.start | replace(from="−",
                            to="") | int %} {% if age.start is
                            starting_with("−") %} {{ start_year }} BC {% else %}
                            {{ start_year }} AD {% endif %}
                            <span class="world-age-card__separator"> → </span>
                            {% set end_year = age.end | replace(from="−", to="")
                            | int %} {% if age.end is starting_with("−") %} {{
                            end_year }} BC {% else %} {{ end_year }} AD {% endif
                            %}
                        </div>

                        <p class="world-age-card__description">
                            {{ age.event }}
                        </p>

                        <div class="world-age-card__footer">
                            <span class="world-age-card__read-more">
                                Explore Age
                                <svg
                                    class="world-age-card__arrow"
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <polyline
                                        points="9,18 15,12 9,6"
                                    ></polyline>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <!-- Images displayed side by side -->
                    <div
                        class="world-age-card__images"
                        id="world-age-images-{{ loop.index }}"
                    >
                        <!-- Images will be populated by JavaScript -->
                    </div>
                </a>
            </article>
            {% endfor %}
        </div>
    </div>
</section>

{% endblock content %}
