{% extends "base.html" %}
{% import "macros/breadcrumbs.html" as breadcrumbs %}

{% block content %}
<!-- DefinedTerm Schema for Wiki Pages -->
{% include "partials/schema/defined-term.html" %}

<div class="wiki">
    <!-- Breadcrumb Navigation -->
    {{ breadcrumbs::wiki(page=page, lang=detected_lang) }}

    <div class="wiki__container">
        <!-- Table of Contents Sidebar -->
        <aside class="wiki__toc" role="complementary" aria-label="Table of contents">
            <div class="wiki__toc-header">
                <h3 class="wiki__toc-title" id="toc-heading">Contents</h3>
            </div>
            <nav class="wiki__toc-nav" aria-labelledby="toc-heading">
                {% if page.toc %}
                <ul class="wiki__toc-list">
                    {% for h1 in page.toc %}
                    <li class="wiki__toc-item wiki__toc-item--level-1">
                        <a href="#{{ h1.id }}" class="wiki__toc-link"
                            >{{ h1.title }}</a
                        >
                        {% if h1.children %}
                        <ul class="wiki__toc-sublist">
                            {% for h2 in h1.children %}
                            <li class="wiki__toc-item wiki__toc-item--level-2">
                                <a href="#{{ h2.id }}" class="wiki__toc-link"
                                    >{{ h2.title }}</a
                                >
                                {% if h2.children %}
                                <ul class="wiki__toc-sublist">
                                    {% for h3 in h2.children %}
                                    <li
                                        class="wiki__toc-item wiki__toc-item--level-3"
                                    >
                                        <a
                                            href="#{{ h3.id }}"
                                            class="wiki__toc-link"
                                            >{{ h3.title }}</a
                                        >
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="wiki__main">
            <article class="wiki__article" role="article" aria-labelledby="wiki-title">
                <!-- Page Header -->
                <header class="wiki__header">
                    <h1 class="wiki__title" id="wiki-title">{{ page.title }}</h1>

                    <!-- Alternative Names/Spellings -->
                    {% if page.extra.alternative_names %}
                    <div class="wiki__alternative-names">
                        <span class="wiki__alternative-label"
                            >Also known as:</span
                        >
                        <span class="wiki__alternative-list">
                            {% for name in page.extra.alternative_names %}
                            <span class="wiki__alternative-name"
                                >{{ name }}</span
                            >{% if not loop.last %}, {% endif %} {% endfor %}
                        </span>
                    </div>
                    {% endif %}

                    <!-- Quick Answer / Management Summary - Optimized for AI extraction and voice assistants -->
                    {% if page.extra.summary or page.description %}
                    <div class="wiki__summary quick-answer" data-ai-summary="true" data-ai-answer="true" aria-label="Quick summary" itemprop="abstract">
                        <div class="wiki__summary-label">
                            <svg class="wiki__summary-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 16v-4"></path>
                                <path d="M12 8h.01"></path>
                            </svg>
                            Quick Answer
                        </div>
                        <div class="wiki__summary-content wiki__tldr" data-speakable="true">
                            {{ page.extra.summary |
                            default(value=page.description) | markdown | safe }}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Metadata -->
                    <div class="wiki__meta">
                        {% if page.reading_time %}
                        <span class="wiki__reading-time">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            {{ page.reading_time }} min read
                        </span>
                        {% endif %}
                        {% include "partials/listen-button.html" %}
                        {% if page.date %}
                        <time class="wiki__date">
                            Last updated: {{ page.date | date(format="%B %d,
                            %Y") }}
                        </time>
                        {% endif %} {% if page.extra.category %}
                        <span class="wiki__category"
                            >Category: {{ page.extra.category }}</span
                        >
                        {% endif %}
                    </div>

                    <!-- Social Share -->
                    {% include "partials/social-share.html" %}
                </header>

                <!-- Page Content -->
                {% if page.content %}
                <div class="wiki__content" data-ai-definition="true" itemscope itemtype="https://schema.org/DefinedTerm">
                    <meta itemprop="name" content="{{ page.title }}">
                    <meta itemprop="description" content="{{ page.description | default(value='') }}">
                    {{ page.content | safe }}
                </div>
                {% endif %}

                <!-- See Also Section -->
                {% if page.extra.see_also %}
                <section class="wiki__see-also" role="complementary" aria-label="Related topics">
                    <h2 class="wiki__section-title" id="see-also-heading">See also</h2>
                    <ul class="wiki__link-list">
                        {% for item in page.extra.see_also %}
                        <li class="wiki__link-item">
                            {% if item.url %}
                            <a href="{{ item.url }}" class="wiki__link"
                                >{{ item.title }}</a
                            >
                            {% else %}
                            <a
                                href="{{ get_url(path=item.path, lang=detected_lang) }}"
                                class="wiki__link"
                                >{{ item.title }}</a
                            >
                            {% endif %} {% if item.description %}
                            <span class="wiki__link-description"
                                >{{ item.description }}</span
                            >
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </section>
                {% endif %}

                <!-- External Links Section -->
                {% if page.extra.external_links %}
                <section class="wiki__external-links">
                    <h2 class="wiki__section-title">External links</h2>
                    <ul class="wiki__link-list">
                        {% for link in page.extra.external_links %}
                        <li class="wiki__link-item">
                            <a
                                href="{{ link.url }}"
                                class="wiki__link wiki__link--external"
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                {{ link.title }}
                                <svg
                                    class="wiki__external-icon"
                                    width="12"
                                    height="12"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                                    ></path>
                                    <polyline
                                        points="15,3 21,3 21,9"
                                    ></polyline>
                                    <line x1="10" y1="14" x2="21" y2="3"></line>
                                </svg>
                            </a>
                            {% if link.description %}
                            <span class="wiki__link-description"
                                >{{ link.description }}</span
                            >
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </section>
                {% endif %}

                <!-- References Section -->
                {% if page.extra.references %}
                <section class="wiki__references" role="doc-endnotes" aria-label="References and citations" data-ai-cite="true">
                    <h2 class="wiki__section-title" id="references-heading">References</h2>
                    <ol class="wiki__reference-list" itemscope itemtype="https://schema.org/ItemList">
                        {% for ref in page.extra.references %}
                        <li
                            class="wiki__reference-item"
                            id="ref-{{ loop.index }}"
                        >
                            {% if ref.url %}
                            <a
                                href="{{ ref.url }}"
                                class="wiki__reference-link"
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                {{ ref.title }}
                            </a>
                            {% else %}
                            <span class="wiki__reference-title"
                                >{{ ref.title }}</span
                            >
                            {% endif %} {% if ref.author %}
                            <span class="wiki__reference-author"
                                >by {{ ref.author }}</span
                            >
                            {% endif %} {% if ref.publication %}
                            <span class="wiki__reference-publication"
                                >{{ ref.publication }}</span
                            >
                            {% endif %} {% if ref.date %}
                            <span class="wiki__reference-date"
                                >({{ ref.date }})</span
                            >
                            {% endif %} {% if ref.description %}
                            <p class="wiki__reference-description">
                                {{ ref.description }}
                            </p>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ol>
                </section>
                {% endif %}

                <!-- Auto-generated footnotes (if using markdown footnotes) -->
                {% set has_footnotes = page.content | split(pat="[^") | length >
                1 %} {% if has_footnotes %}
                <section class="wiki__footnotes">
                    <!-- Footnotes will be auto-generated by Zola's markdown parser -->
                </section>
                {% endif %}

                <!-- Related Content -->
                {% include "partials/related-content.html" %}
            </article>
        </main>
    </div>
</div>
{% endblock content %}
