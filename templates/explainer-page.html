{% extends "base.html" %}
{% import "macros/breadcrumbs.html" as breadcrumbs %}

{% block content %}
<!-- ScholarlyArticle Schema for Explainer Pages -->
{% include "partials/schema/scholarly-article.html" %}

<div class="explainer">
    <!-- Breadcrumb Navigation -->
    {{ breadcrumbs::explainer(page=page, lang=detected_lang) }}

    <div class="explainer__container">
        <!-- Main Content -->
        <main class="explainer__main">
            <article class="explainer__article" role="article" aria-labelledby="explainer-title">
                <!-- Hero Image Section -->
                {% if page.extra.header_image %}
                <div class="explainer__hero">
                    <img
                        src="{{ page.extra.header_image }}"
                        alt="{{ page.title }}"
                        class="explainer__hero-image"
                    />
                    <div class="explainer__hero-overlay">
                        <h1 class="explainer__hero-title" id="explainer-title">{{ page.title }}</h1>
                    </div>
                </div>
                {% else %}
                <div class="explainer__hero explainer__hero--no-image">
                    <div class="explainer__hero-overlay">
                        <h1 class="explainer__hero-title" id="explainer-title">{{ page.title }}</h1>
                    </div>
                </div>
                {% endif %}

                <!-- Page Header -->
                <header class="explainer__header">
                    <!-- Metadata -->
                    <div class="explainer__meta" aria-label="Article metadata">
                        {% if page.reading_time %}
                        <span class="explainer__reading-time">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            {{ page.reading_time }} min read
                        </span>
                        {% endif %}
                        {% include "partials/listen-button.html" %}
                        {% if page.date %}
                        <time class="explainer__date">
                            Last updated: {{ page.date | date(format="%B %d,
                            %Y") }}
                        </time>
                        {% endif %} {% if page.extra.category %}
                        <span class="explainer__category"
                            >Category: {{ page.extra.category }}</span
                        >
                        {% endif %}
                    </div>

                    <!-- Social Share -->
                    {% include "partials/social-share.html" %}
                </header>

                <!-- Quick Summary for AI extraction -->
                {% if page.extra.tldr or page.description %}
                <div class="explainer__summary" data-ai-summary="true" aria-label="Quick summary">
                    <p class="explainer__tldr explainer__content">
                        {{ page.extra.tldr | default(value=page.description) }}
                    </p>
                </div>
                {% endif %}

                <!-- Page Content -->
                {% if page.content %}
                <div class="explainer__content">{{ page.content | safe }}</div>
                {% endif %}

                <!-- See Also Section -->
                {% if page.extra.see_also %}
                <section class="explainer__see-also" role="complementary" aria-label="Related articles">
                    <h2 class="explainer__section-title">See also</h2>
                    <ul class="explainer__link-list">
                        {% for item in page.extra.see_also %}
                        <li class="explainer__link-item">
                            {% if item.url %}
                            <a href="{{ item.url }}" class="explainer__link"
                                >{{ item.title }}</a
                            >
                            {% else %}
                            <a
                                href="{{ get_url(path=item.path, lang=detected_lang) }}"
                                class="explainer__link"
                                >{{ item.title }}</a
                            >
                            {% endif %} {% if item.description %}
                            <span class="explainer__link-description"
                                >{{ item.description }}</span
                            >
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </section>
                {% endif %}

                <!-- External Links Section -->
                {% if page.extra.external_links %}
                <section class="explainer__external-links">
                    <h2 class="explainer__section-title">External links</h2>
                    <ul class="explainer__link-list">
                        {% for link in page.extra.external_links %}
                        <li class="explainer__link-item">
                            <a
                                href="{{ link.url }}"
                                class="explainer__link explainer__link--external"
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                {{ link.title }}
                                <svg
                                    class="explainer__external-icon"
                                    width="12"
                                    height="12"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                                    ></path>
                                    <polyline
                                        points="15,3 21,3 21,9"
                                    ></polyline>
                                    <line x1="10" y1="14" x2="21" y2="3"></line>
                                </svg>
                            </a>
                            {% if link.description %}
                            <span class="explainer__link-description"
                                >{{ link.description }}</span
                            >
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </section>
                {% endif %}

                <!-- References Section -->
                {% if page.extra.references %}
                <section class="explainer__references" role="doc-bibliography" aria-label="References and citations">
                    <h2 class="explainer__section-title">References</h2>
                    <ol class="explainer__reference-list">
                        {% for ref in page.extra.references %}
                        <li
                            class="explainer__reference-item"
                            id="ref-{{ loop.index }}"
                        >
                            {% if ref.url %}
                            <a
                                href="{{ ref.url }}"
                                class="explainer__reference-link"
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                {{ ref.title }}
                            </a>
                            {% else %}
                            <span class="explainer__reference-title"
                                >{{ ref.title }}</span
                            >
                            {% endif %} {% if ref.author %}
                            <span class="explainer__reference-author"
                                >by {{ ref.author }}</span
                            >
                            {% endif %} {% if ref.publication %}
                            <span class="explainer__reference-publication"
                                >{{ ref.publication }}</span
                            >
                            {% endif %} {% if ref.date %}
                            <span class="explainer__reference-date"
                                >({{ ref.date }})</span
                            >
                            {% endif %} {% if ref.description %}
                            <p class="explainer__reference-description">
                                {{ ref.description }}
                            </p>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ol>
                </section>
                {% endif %}

                <!-- Auto-generated footnotes (if using markdown footnotes) -->
                {% set has_footnotes = page.content | split(pat="[^") | length >
                1 %} {% if has_footnotes %}
                <section class="explainer__footnotes">
                    <!-- Footnotes will be auto-generated by Zola's markdown parser -->
                </section>
                {% endif %}
            </article>
        </main>
    </div>
</div>
{% endblock content %}
